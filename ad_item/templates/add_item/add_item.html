{% extends '_base.html' %}
{% load static %}
{% block css %}
    <link rel="stylesheet" href="{% static 'ad-item/additem1.css' %}">
{% endblock %}
{% block body %}
    <style>

    </style>
    <div class="container mt-5 text-white">
        <h2 class="mb-4"> ثبت محصول</h2>
        <form method="POST" enctype="multipart/form-data" id="productForm">
            {% csrf_token %}

            <!-- Nav Tabs -->
            <ul class="nav nav-tabs mb-4" id="productTabs" role="tablist">
                <li class="nav-item">
                    <button class="nav-link active" id="general-tab" data-bs-toggle="tab" data-bs-target="#general"
                            type="button" role="tab" aria-controls="general" aria-selected="true">
                        مشخصات
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" id="images-tab" data-bs-toggle="tab" data-bs-target="#images" type="button"
                            role="tab" aria-controls="images" aria-selected="false">
                        تصاویر
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" id="location-tab" data-bs-toggle="tab" data-bs-target="#location"
                            type="button" role="tab" aria-controls="location" aria-selected="false">
                        موقعیت مکانی
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" id="collateral-tab" data-bs-toggle="tab" data-bs-target="#collateral"
                            type="button" role="tab" aria-controls="collateral" aria-selected="false">
                        وثیقه
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" id="pricing-tab" data-bs-toggle="tab" data-bs-target="#pricing"
                            type="button" role="tab" aria-controls="pricing" aria-selected="false">
                        هزینه اجاره
                    </button>
                </li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content" id="productTabsContent">
                <!-- اطلاعات عمومی -->
                <div class="tab-pane fade show active" id="general" role="tabpanel" aria-labelledby="general-tab">
                    <div class="form-group mb-3">
                        {{ form.category.label }}<br>
                        {{ form.category }}
                    </div>
                    <div class="form-group mb-3">
                        {{ form.title.label }}<br>
                        {{ form.title }}
                    </div>
                    <div class="form-group mb-3">
                        {{ form.description.label }}<br>
                        {{ form.description }}
                    </div>
                    <div class="form-group mb-3">
                        {{ form.quantity_available.label }}<br>
                        {{ form.quantity_available }}
                    </div>
                    <button type="button" class="btn btn-primary next-tab">بعدی</button>
                </div>

                <!-- تصاویر -->
                <div class="tab-pane fade" id="images" role="tabpanel" aria-labelledby="images-tab">
                    <div class="form-group mb-3">
                        {{ form.images.label }}<br>
                        <input type="file" id="imageInput" name="image" multiple class="form-control">
                    </div>
                    <div id="imagePreviewContainer" class="d-flex flex-wrap gap-3 mt-3">
                    </div>
                    <br>
                    <button type="button" class="btn btn-secondary prev-tab">برگشت</button>
                    <button type="button" class="btn btn-primary next-tab">بعدی</button>
                </div>

                <!-- موقعیت مکانی -->
                <div class="tab-pane fade" id="location" role="tabpanel" aria-labelledby="location-tab">
                    <div class="form-group mb-3">
                        {{ form.province.label }}<br>
                        {{ form.province }}
                    </div>
                    <div class="form-group mb-3">
                        {{ form.city.label }}<br>
                        {{ form.city }}
                    </div>
                    <div class="form-group mb-3">
                        {{ form.address.label }}<br>
                        {{ form.address }}
                    </div>
                    <button type="button" class="btn btn-secondary prev-tab">برگشت</button>
                    <button type="button" class="btn btn-primary next-tab">بعدی</button>
                </div>

                <!-- وثیقه -->
                <div class="tab-pane fade" id="collateral" role="tabpanel" aria-labelledby="collateral-tab">
                    <h4>موارد وثیقه</h4>
                    <div class="form-check">
                        <input type="checkbox" name="collateral_required" class="form-check-input"
                               id="id_collateral_required">
                        <label class="form-check-label" for="id_collateral_required">آیا وثیقه نیاز است؟</label>

                    </div>
                    <div>
                        {% for collateral in form.collateral_types %}
                            <div class="form-check">
                                {{ collateral.tag }}
                                <label class="form-check-label"
                                       for="{{ collateral.id }}">{{ collateral.choice_label }}</label>
                            </div>
                        {% endfor %}
                    </div>
                    <button type="button" class="btn btn-secondary prev-tab">برگشت</button>
                    <button type="button" class="btn btn-primary next-tab">بعدی</button>
                </div>

                <!-- هزینه اجاره -->
                <div class="tab-pane fade" id="pricing" role="tabpanel" aria-labelledby="pricing-tab">
                    <div class="form-group mb-3">
                        قیمت برای هر یک روز
                        {{ form.price_per_day }}
                        <br>
                         کل ارزش محصول
                        {{ form.item_value }}
                    </div>
                    <button type="button" class="btn btn-secondary prev-tab">برگشت</button>
                    <button type="submit" class="btn btn-success">ثبت محصول</button>
                </div>
            </div>
        </form>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const tabs = document.querySelectorAll('#productTabs button');
            const nextButtons = document.querySelectorAll('.next-tab');
            const prevButtons = document.querySelectorAll('.prev-tab');

            nextButtons.forEach((btn, index) => {
                btn.addEventListener('click', () => {
                    tabs[index + 1].click();
                });
            });

            prevButtons.forEach((btn, index) => {
                btn.addEventListener('click', () => {
                    tabs[index].click();
                });
            });
        });
        document.addEventListener('DOMContentLoaded', function () {
            const imageInput = document.getElementById('imageInput');
            const imagePreviewContainer = document.getElementById('imagePreviewContainer');

            imageInput.addEventListener('change', function () {
                // پاک کردن پیش‌نمایش‌های قبلی
                imagePreviewContainer.innerHTML = '';

                // خواندن فایل‌های انتخاب‌شده
                const files = Array.from(this.files);
                files.forEach((file, index) => {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        // ساخت کارت پیش‌نمایش
                        const imageCard = document.createElement('div');
                        imageCard.classList.add('card', 'p-2');
                        imageCard.style.width = '150px';
                        imageCard.style.position = 'relative';

                        // پیش‌نمایش تصویر
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.alt = file.name;
                        img.classList.add('card-img-top');
                        img.style.height = '100px';
                        img.style.objectFit = 'cover';

                        // دکمه حذف
                        const removeButton = document.createElement('button');
                        removeButton.classList.add('btn', 'btn-danger', 'btn-sm');
                        removeButton.style.position = 'absolute';
                        removeButton.style.top = '5px';
                        removeButton.style.right = '5px';
                        removeButton.innerText = 'حذف';
                        removeButton.addEventListener('click', function () {
                            files.splice(index, 1);
                            imageCard.remove();

                            const dataTransfer = new DataTransfer();
                            files.forEach(file => dataTransfer.items.add(file));
                            imageInput.files = dataTransfer.files;
                        });

                        imageCard.appendChild(img);
                        imageCard.appendChild(removeButton);
                        imagePreviewContainer.appendChild(imageCard);
                    };

                    reader.readAsDataURL(file);
                });
            });
        });
    </script>
{% endblock %}
